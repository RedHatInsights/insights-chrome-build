"use strict";(self.webpackChunkinsights_chrome=self.webpackChunkinsights_chrome||[]).push([[5455],{36522:(e,t,o)=>{o.d(t,{yb:()=>d,wr:()=>p});var n=o(96985),s=o.n(n),a=o(45697),r=o.n(a),i=o(9390),c=o.n(i),l=o(45237);const u={url:`${document.location.origin}/api/featureflags/v0`,clientKey:"proxy-123",appName:"web",headerName:"X-Unleash-Auth",refreshInterval:6e4,metrcisInterval:12e4},h="chrome:feature-flags:error";let d;localStorage.setItem(h,"false");const p=()=>"true"===localStorage.getItem(h),m=({children:e})=>{const t=(0,l.useSelector)((e=>e.chrome.user)),o=(0,n.useRef)();return(0,n.useEffect)((()=>{t&&!o.current&&(o.current=new i.UnleashClient({...u,context:{properties:{account_number:t.identity.account_number}}}),d=o.current,d.on("error",(()=>{localStorage.setItem(h,"true")})))}),[t]),p()||!o.current?s().createElement(i.FlagProvider,{config:u},e):s().createElement(c(),{unleashClient:o.current},e)};m.propTypes={children:r().node.isRequired}},14734:(e,t,o)=>{o.d(t,{ZP:()=>a});o(77460),o(27361);var n=o(41609),s=o.n(n);o(31955),o(36522),o(35755);s();const a=Object.freeze({noAuthParam:"noauth",offlineToken:"2402500adeacc30eb5c5a8a5e2e0ec1f"})},44057:(e,t,o)=>{o.d(t,{Z:()=>s});var n=o(94671);const s=class{_cookie;_keycloak;cookie;logoutDelay;logoutTimeout;constructor(){this._cookie,this._keycloak={},this.logoutDelay=108e5}setCookie(e){this.cookie=e}setKeycloak(e,t,o,s){this._keycloak=new n.Z(e),this._keycloak.onTokenExpired=t,this._keycloak.onAuthSuccess=o,this._keycloak.onAuthRefreshSuccess=s}initializeKeycloak(e){this._keycloak?.init(e)}setToken(e){this._keycloak.authenticated=!0,this._keycloak.token=e}initialize(e){return this._keycloak.init(e)}setTokenParsed(e){this._keycloak.tokenParsed=e}getTokenParsed(){return this._keycloak.tokenParsed}getToken(){return this._keycloak.token}getRefershToken(){return this._keycloak.refreshToken}login(e){return this._keycloak.login(e).then((e=>(this.logoutTimeout&&clearTimeout(this.logoutTimeout),this.logoutTimeout=setTimeout((()=>{this.logout()}),this.logoutDelay),e)))}clearToken(){this._keycloak.clearToken()}getCookie(){return this.cookie}logout(e={}){return this._keycloak.logout(e)}getAuthenticated(){return this._keycloak.authenticated}updateToken(){return this._keycloak.updateToken(5)}}},11577:(e,t,o)=>{o.d(t,{wM:()=>n,YM:()=>s});const n={prod:{url:["access.redhat.com","prod.foo.redhat.com","cloud.redhat.com","console.redhat.com"],sso:"https://sso.redhat.com/auth",portal:"https://access.redhat.com"},qa:{url:["qa.foo.redhat.com","qa.cloud.redhat.com","qa.console.redhat.com"],sso:"https://sso.qa.redhat.com/auth",portal:"https://access.qa.redhat.com"},ci:{url:["ci.foo.redhat.com","ci.cloud.redhat.com","ci.console.redhat.com"],sso:"https://sso.qa.redhat.com/auth",portal:"https://access.qa.redhat.com"},qaprodauth:{url:["qaprodauth.foo.redhat.com","qaprodauth.cloud.redhat.com","qaprodauth.console.redhat.com"],sso:"https://sso.redhat.com/auth",portal:"https://access.redhat.com"},stage:{url:["stage.foo.redhat.com","cloud.stage.redhat.com","console.stage.redhat.com","fetest.stage.redhat.com"],sso:"https://sso.stage.redhat.com/auth",portal:"https://access.stage.redhat.com"},gov:{url:["gov.cloud.redhat.com","gov.console.redhat.com"],sso:"https://sso.redhat.com/auth",portal:"https://access.redhat.com"},govStage:{url:["gov.cloud.stage.redhat.com","gov.console.stage.redhat.com"],sso:"https://sso.stage.redhat.com/auth",portal:"https://access.redhat.com"},dev:{url:["console.dev.redhat.com"],sso:"https://sso.redhat.com/auth",portal:"https://access.redhat.com"}},s={realm:"redhat-external",clientId:"cloud-services",cookieName:"cs_jwt"}},88377:(e,t,o)=>{o.d(t,{Z:()=>l});var n=o(9669),s=o.n(n),a=o(49268),r=o(35755),i=o(28997);const c="/api/entitlements/v1",l=e=>{const t=(0,i.h4)(c,`${e}-entitlements`),o=s().create({adapter:t.adapter});return o.interceptors.response.use((e=>{if(e&&e.request&&!0!==e.request.fromCache){const e=(0,r.Qn)("/api/entitlements/v1/services","fallback"),t=Object.keys(localStorage).filter((t=>t.endsWith("/api/entitlements/v1/services")&&t!==e));(0,r.gB)(t)}return e.data||e})),new a.ServicesApi(void 0,c,o)}},61480:(e,t,o)=>{o.d(t,{WN:()=>l,xw:()=>u});var n=o(14734),s=o(11577),a=o(13606),r=o(9669),i=o.n(r);const c={};function l(){if(-1!==h().location.href.indexOf(n.ZP.offlineToken)){const{hash:e,search:t,origin:o,pathname:s}=h().location,a=new URLSearchParams(t).get(n.ZP.noAuthParam);c.postbackUrl=`${o}${s}?${n.ZP.noAuthParam}=${a}${e}`,h().location.hash="";const r=new URL(h().location.href);r.searchParams.delete(n.ZP.noAuthParam),h().history.pushState("offlinePostback","",r.toString())}}async function u(e,t,o){const n=function(){const e=c.postbackUrl;return delete c.postbackUrl,e}();if(c.response)return Promise.resolve(c.response);if(!n)return Promise.reject("not available");const r=`${await(0,a.Z)(s.wM,o)}/realms/${e}/protocol/openid-connect/token`,l=n.split("#")[1].split("&").reduce(((e,t)=>{const o=t.split("=");return e[o[0]]=o[1],e}),{});var u;return i().post(r,(u=function(e,t,o){return{code:o,grant_type:"authorization_code",client_id:t,redirect_uri:encodeURIComponent(e.split("#")[0])}}(n,t,l.code),Object.entries(u).map((e=>`${e[0]}=${e[1]}`)).join("&")),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((e=>(c.response=e,e)))}function h(){return window}},13606:(e,t,o)=>{o.d(t,{Z:()=>s});const n=(0,o(18579).Z)("insights/url.js"),s=async(e,t)=>{if(t)return t;const o=Object.entries(e).find((([,{url:e}])=>e.includes(location.hostname)));return o?(n(`SSO Url: ${o?.[1].sso}`),n(`Current env: ${o?.[0]}`),o?.[1].sso):(n("SSO url: not found, defaulting to qa"),n("Current env: not found, defaultint to qa"),"https://sso.qa.redhat.com/auth")}},69083:(e,t,o)=>{o.d(t,{ZP:()=>d});var n=o(35755),s=o(88377),a=o(18579),r=o(29318);const i=(0,a.Z)("insights/user.js"),c={"cost-management":"cost_management",insights:"insights",openshift:"openshift",migrations:"migrations",ansible:"ansible",subscriptions:"subscriptions",settings:"settings","user-preferences":"user_preferences",internal:"internal"},l=`${document.location.origin}${(0,n.hN)()?"beta/":"/"}`;function u(){return window}function h(e,t){if("insights"!==t&&"openshift"!==t&&"cost-management"!==t&&"migrations"!==t&&"ansible"!==t&&"subscriptions"!==t&&"settings"!==t&&"user-preferences"!==t&&"internal"!==t)return;const o=(0,r.Co)();if("ansible"===t&&o)return;const n=c[t],s=((e,t,o=!1)=>({ansible:`${l}ansible/ansible-dashboard/${o?"trial/expired":"trial"}`}[e]||`${l}?not_entitled=${t}`))(t,n,!1===o);!0===e&&u().location.replace(s),t&&"object"==typeof e&&(e?.[n]?.is_entitled?i(`Entitled to: ${n}`):(i(`Not entitled to: ${n}`),u().location.replace(s)))}const d=async e=>{const t=function(e){return e?{identity:{account_number:e.account_number,org_id:e.org_id,type:e.type,...e.idp&&{idp:e.idp},user:{username:e.username,email:e.email,first_name:e.first_name,last_name:e.last_name,is_active:e.is_active,is_org_admin:e.is_org_admin,is_internal:e.is_internal,locale:e.locale},internal:{org_id:e.org_id,account_id:e.account_id}}}:null}(e),o=u().location.pathname.split("/");if(o.shift(),"beta"===o[0]&&o.shift(),"subscriptions"!==o?.[1]&&"cost-management"!==o?.[1]||o.shift(),t){i(`Account Number: ${t.identity.account_number}`);let a={};try{t.identity.account_number?a=await(0,s.Z)(e.jti).servicesGet():console.log("Cannot call entitlements API, no account number")}catch{}return(0,n.$s)()?{...t,entitlements:a}:(0,n.iB)(t.identity.account_number)?(h(a,o[0]),{...t,entitlements:a}):void h(!0,o[0])}i("User not ready")}},71093:(e,t,o)=>{o.r(t),o.d(t,{GLOBAL_FILTER_KEY:()=>g,decodeToken:()=>_,doOffline:()=>v,init:()=>T,isExistingValid:()=>S,initSuccess:()=>$,initError:()=>x,login:()=>P,logout:()=>Z,logoutAllTabs:()=>C,getUserInfo:()=>I,isAuthenticated:()=>A,expiredToken:()=>N,updateToken:()=>U,getCookieExpires:()=>q,setCookie:()=>M,setCookieWrapper:()=>E,getEncodedToken:()=>W,getUrl:()=>R});var n=o(94671),s=o(87728),a=o(31955),r=o(35755),i=o(92876),c=o(18579),l=o(13606),u=o(69083),h=o(54998),d=o.n(h),p=o(11577),m=o(44057);const g="chrome:global-filter",f=(0,c.Z)("jwt.js"),k="cs_jwt",w=new m.Z,b=new s.g0("auth");function y(e){const t=e.replace(/^\/beta\//,"/").replace(/^\//,"");if(t.match(/^connect\/.+/))return`api.partner_link.${t.split("/")[1]}`}function _(e){switch((e=(e=(e=e.split(".")[1]).replace("/-/g","+")).replace("/_/g","/")).length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Invalid token"}e=(e=(e+"===").slice(0,e.length+e.length%4)).replace(/-/g,"+").replace(/_/g,"/"),e=decodeURIComponent(escape(atob(e)));return JSON.parse(e)}b.onmessage=e=>{if(e&&e.data&&e.data.type)switch(f(`BroadcastChannel, Received event : ${e.data.type}`),e.data.type){case"logout":return Z();case"login":return P();case"refresh":return U()}};const v=(e,t,o)=>{const s=d()(window.location.href);s.removeSearch(e),s.addSearch(e,t),Promise.resolve((0,l.Z)(p.wM,o)).then((async e=>{const t={...p.YM,promiseType:"native",redirectUri:s.toString(),url:e},o=new n.Z(t);await o.init(t);const a=y(window.location.pathname);o.login({scope:"offline_access"+(a?` ${a}`:"")})}))},T=(e,t)=>{f("Initializing");const o=e.cookieName?e.cookieName:k;return w.setCookie({cookieName:o}),Promise.resolve((0,l.Z)(e.routes?e.routes:p.wM,t)).then((t=>{e.url=t,e.clientId="cloud-services",e.realm="redhat-external",e.promiseType="native",e.onLoad="check-sso",e.checkLoginIframe=!1;const o="beta"===window.location.pathname.split("/")[1]?"/beta":"";if(e.silentCheckSsoRedirectUri=`https://${window.location.host}${o}/apps/chrome/silent-check-sso.html`,window.localStorage&&"true"===window.localStorage.getItem("chrome:jwt:shortSession")&&(e.realm="short-session"),w.setKeycloak(e,U,O,j),e.token){if(S(e.token))return w.initializeKeycloak(e),w.setToken(e.token),Promise.resolve();delete e.token}return w.initialize(e).then($).catch(x)}))};function S(e){f("Checking validity of existing JWT");try{if(!e)return!1;const t=_(e);if(!t.exp)return!1;const o=Date.now().toString().substr(0,10),n=t.exp-parseInt(o);return f(`Token expires in ${n}`),n>90?(w.setTokenParsed(t),!0):(f(n>0?"token is expiring in < 90 seconds":"token is expired"),!1)}catch(e){return f(e),!1}}function $(){f("JWT Initialized"),M(w.getToken())}function x(){f("JWT init error"),Z()}function P(){return f("Logging in"),a.Z.set("cs_loggedOut","false"),w.login({redirectUri:location.href,scope:y(window.location.pathname)})}function Z(e){f("Logging out");const t=w.getCookie()?.cookieName;t&&a.Z.remove(t),a.Z.remove("cs_demo");const o="beta"===window.location.pathname.split("/")[1]?"/beta":"",n=Object.keys(localStorage).filter((e=>e.endsWith("/api/entitlements/v1/services")||e.endsWith("/chrome")||e.endsWith("/chrome-store")||e.startsWith("kc-callback")||e.startsWith(g)));if((0,r.gB)(n),e){const e=new Date((new Date).getTime()+8e3);a.Z.set("cs_loggedOut","true",{expires:e}),w.logout({redirectUri:`https://${window.location.host}${o}`}),w.clearToken()}}const C=e=>{b.postMessage({type:"logout"}),Z(e)};function O(){b.postMessage({type:"login"})}const I=()=>{f("Getting User Information");const e=a.Z.get(k);return e&&S(e)&&S(w.getToken())?(0,u.ZP)(w.getTokenParsed()):U().then((()=>(f("Successfully updated token"),(0,u.ZP)(w.getTokenParsed())))).catch((()=>{if((0,r.hM)())return f("Trying to log in user to refresh token"),P()}))},A=()=>(f(`User Ready: ${w.getAuthenticated()}`),w.getAuthenticated()),N=()=>{f("Token has expired, trying to log out"),Z()};function j(){M(w.getToken()),b.postMessage({type:"refresh"})}function U(){return Promise.resolve(w?.updateToken?.()).then((e=>{M(w.getToken()),f("Attempting to update token"),f(e?"Token was successfully refreshed":"Token is still valid, not updating")})).catch((e=>{f(e),i.Tb(e),f("Token updated failed, trying to reauth"),P()}))}function q(e){const t=new Date(0);return t.setUTCSeconds(e),t.toUTCString()}function M(e){if(f("Setting the cs_jwt cookie"),e&&e.length>10){const t=w.getCookie()?.cookieName;t&&E(`${t}=${e};path=/api;secure=true;expires=${q(_(e).exp)}`)}}function E(e){window.document.cookie=e}const W=()=>(f("Trying to get the encoded token"),S(w.getToken())||(f("Failed to get encoded token, trying to update"),U()),w.getToken()),R=e=>(0,l.Z)(p.wM,e)},18579:(e,t,o)=>{o.d(t,{Z:()=>n});const n=e=>t=>{window.console&&window.localStorage&&window.localStorage.getItem("chrome:jwt:debug")&&window.console.log(`[JWT][${e}] ${t}`)}},35455:(e,t,o)=>{o.r(t),o.d(t,{initChromeAuth:()=>l,default:()=>u});var n=o(61480),s=o(71093),a=o(31955),r=o(11577);const i="[JWT][jwt.js] Auth time";function c(){s.isAuthenticated()||(a.Z.remove(r.YM.cookieName),s.login()),console.timeEnd(i)}const l=()=>{console.time(i);const e={...r.YM};(0,n.WN)();const t=a.Z.get(e.cookieName);t&&t.length>10&&(e.token=t);return{initPromise:s.init(e).then(c)}},u=()=>{const e={...r.YM};return{getOfflineToken:()=>(0,n.xw)(e.realm,e.clientId),...s}}},35755:(e,t,o)=>{o.d(t,{iB:()=>s,$s:()=>a,hM:()=>r,gB:()=>i,Qn:()=>c,BB:()=>l,hN:()=>u});o(27361),o(11577),o(94654),o(9669);function n(){return window}function s(e){return!!e&&(-1!==e&&("-1"!==e&&Number.isInteger(Number(e))))}function a(){const e=n().location.pathname;return"/"===e||"/beta"===e||"/beta/"===e||0===e.indexOf("/openshift")||0===e.indexOf("/beta/openshift")||0===e.indexOf("/security")||0===e.indexOf("/beta/security")||0===e.indexOf("/application-services")||0===e.indexOf("/beta/application-services")||0===e.indexOf("/hac")||0===e.indexOf("/beta/hac")||0===e.indexOf("/ansible/ansible-dashboard/trial")||0===e.indexOf("/beta/ansible/ansible-dashboard/trial")}function r(){const e=function(){const e=n().location.pathname.split("/");return"beta"===e[1]?e[2]||"":e[1]}();return"insights"===e||"cost-management"===e||"apps"===e||"ansible"===e||"migrations"===e||"subscriptions"===e||"openshift"===e||"settings"===e||"user-preferences"===e||"internal"===e||"application-services"===e}function i(e){e.map((e=>localStorage.removeItem(e)))}function c(e,t){return Object.keys(localStorage).reduce(((t,o)=>{if(o.includes(e))try{let e;try{const o=localStorage.getItem(t);e=o?new Date(JSON.parse(o)?.expires):new Date}catch{e=new Date}const n=JSON.parse(localStorage.getItem(o)||"");return e>=new Date(n.expires)?t:o}catch(e){return t}return t}),t)}function l(){return"cloud.redhat.com"===location.host||"console.redhat.com"===location.host||location.host.includes("prod.foo.redhat.com")}function u(){return"beta"===window.location.pathname.split("/")[1]}},28997:(e,t,o)=>{o.d(t,{h4:()=>c});var n=o(35974),s=o(69483),a=o.n(s),r=o(35755);const i=(e,t)=>{const o=(0,r.Qn)(e,t);return a().createInstance({driver:[a().LOCALSTORAGE],name:"string"==typeof o?o?.split("/")[0]:o.expires.split("/")[0]})};function c(e,t){const o=i(e,t);return(0,n.setupCache)({store:o,maxAge:6e5})}},29318:(e,t,o)=>{o.d(t,{Co:()=>r});var n=o(18579);const s="chrome.ansible.trial",a=(0,n.Z)("Ansible trial invalidation"),r=()=>{let e=localStorage.getItem(s);if(e)try{return e=parseInt(e),!isNaN(e)&&e+6e5>Date.now()}catch(e){a(`Enable to parse ansible trial flag expiration: ${e}`)}}}}]);