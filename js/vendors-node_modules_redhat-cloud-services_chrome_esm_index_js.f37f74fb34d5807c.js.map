{"version":3,"file":"vendors-node_modules_redhat-cloud-services_chrome_esm_index_js.f37f74fb34d5807c.js","mappings":";;;;;;;;;;;;;;;AAAsC;AACtC,oBAAoB,oDAAa;AACjC,0BAA0B,mBAAmB;AAC7C,kCAAkC,mBAAmB;AACrD,oCAAoC,mBAAmB;AACvD,6BAA6B,mBAAmB;AAChD,+BAA+B,mBAAmB;AAClD,+BAA+B,mBAAmB;AAClD,qCAAqC,mBAAmB;AACxD,4BAA4B;AAC5B;AACA,yBAAyB;AACzB;AACA,0BAA0B;AAC1B;AACA,KAAK,IAAI;AACT,CAAC;AACD,iEAAe,aAAa,EAAC;AAC7B;;;;;;;;;;;;;;;;AClB0C;AACiB;AAC3D;;;;;;;;;;;;;;;;;;;;;;;;ACFA,iBAAiB,SAAI,IAAI,SAAI;AAC7B,4BAA4B,+DAA+D,iBAAiB;AAC5G;AACA,oCAAoC,MAAM,+BAA+B,YAAY;AACrF,mCAAmC,MAAM,mCAAmC,YAAY;AACxF,gCAAgC;AAChC;AACA,KAAK;AACL;AACA,mBAAmB,SAAI,IAAI,SAAI;AAC/B,cAAc,6BAA6B,0BAA0B,cAAc,qBAAqB;AACxG,iBAAiB,oDAAoD,qEAAqE,cAAc;AACxJ,uBAAuB,sBAAsB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC;AACxC,mCAAmC,SAAS;AAC5C,mCAAmC,WAAW,UAAU;AACxD,0CAA0C,cAAc;AACxD;AACA,8GAA8G,OAAO;AACrH,iFAAiF,iBAAiB;AAClG,yDAAyD,gBAAgB,QAAQ;AACjF,+CAA+C,gBAAgB,gBAAgB;AAC/E;AACA,kCAAkC;AAClC;AACA;AACA,UAAU,YAAY,aAAa,SAAS,UAAU;AACtD,oCAAoC,SAAS;AAC7C;AACA;AACA,qBAAqB,SAAI,IAAI,SAAI;AACjC,6EAA6E,OAAO;AACpF;AACA;AACA;AACA;AACA;AACA;AACA;AACgD;AACI;AACD;AACJ;AACE;AACT;AACmC;AAC3E,oCAAoC,OAAO,iDAAG,CAAC,sDAAY;AAC3D;AACA;AACA;AACA,0BAA0B,6CAAM;AAChC,iDAAiD;AACjD;AACA;AACA;AACA;AACA;AACA,+BAA+B,kDAAI,CAAC,0DAAgB;AACpD;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA,sBAAsB,kDAAkD;AACxE,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL,IAAI,gDAAS;AACb,uDAAuD;AACvD;AACA;AACA;AACA,aAAa;AACb,SAAS,IAAI;AACb;AACA;AACA;AACA;AACA;AACA,mEAAmE;AACnE;AACA;AACA;AACA,qBAAqB;AACrB,iBAAiB,IAAI;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,mBAAmB,6DAAW;AAC9B,mBAAmB,iEAAW;AAC9B;AACA,wCAAwC;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,iDAAG,CAAC,0DAAgB;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL,IAAI,gDAAS;AACb;AACA,KAAK;AACL,IAAI,gDAAS;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2GAA2G,oCAAoC;AAC/I,4CAA4C,iJAAiJ;AAC7L;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,oBAAoB,6CAAM;AAC1B,aAAa,+CAAQ;AACrB,wBAAwB,6CAAM;AAC9B;AACA,gCAAgC,wDAAW;AAC3C;AACA;AACA;AACA,IAAI,gDAAS;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,KAAK;AACL,WAAW,sDAAI,CAAC,sDAAa,aAAa,kDAAkD;AAC5F;AACA,iEAAe,cAAc,EAAC;AAC9B;;;;;;;;;;;;;;;AChPA,gBAAgB,SAAI,IAAI,SAAI;AAC5B;AACA,iDAAiD,OAAO;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,SAAI,IAAI,SAAI;AAC1B;AACA;AACA;AACA;AACA,6DAA6D,cAAc;AAC3E;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA,CAAC,oCAAoC;AACrC;AACA;AACA;AACA;AACA,0BAA0B;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,oBAAoB;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC;AACpC;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,2CAA2C,yBAAyB;AACpE;AACA;AACA,6CAA6C,sBAAsB;AACnE;AACA;AACA,8CAA8C,gCAAgC;AAC9E;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,2BAA2B,mBAAmB;AAC3F;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iEAAe,WAAW,EAAC;AAC3B;;;;;;;;;;;;;;;;;;ACnG6D;AAClB;AACE;AAC7C;;;;;;;;;;;;;;;;;;;;;;;;ACHiC;AACD;AACC;AACE;AACC;AACpC;;;;;;;;;;;;;;;;ACL6C;AACoB;AACjE;;;;;;;;;;;;;;;;;;;ACFA,iBAAiB,SAAI,IAAI,SAAI;AAC7B,4BAA4B,+DAA+D,iBAAiB;AAC5G;AACA,oCAAoC,MAAM,+BAA+B,YAAY;AACrF,mCAAmC,MAAM,mCAAmC,YAAY;AACxF,gCAAgC;AAChC;AACA,KAAK;AACL;AACA,mBAAmB,SAAI,IAAI,SAAI;AAC/B,cAAc,6BAA6B,0BAA0B,cAAc,qBAAqB;AACxG,iBAAiB,oDAAoD,qEAAqE,cAAc;AACxJ,uBAAuB,sBAAsB;AAC7C;AACA;AACA;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cAAc;AACxJ,uBAAuB,sBAAsB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC;AACxC,mCAAmC,SAAS;AAC5C,mCAAmC,WAAW,UAAU;AACxD,0CAA0C,cAAc;AACxD;AACA,8GAA8G,OAAO;AACrH,iFAAiF,iBAAiB;AAClG,yDAAyD,gBAAgB,QAAQ;AACjF,+CAA+C,gBAAgB,gBAAgB;AAC/E;AACA,kCAAkC;AAClC;AACA;AACA,UAAU,YAAY,aAAa,SAAS,UAAU;AACtD,oCAAoC,SAAS;AAC7C;AACA;AACO;AACA;AACA;AACA;AACA;AACP;AACA;AACA,qDAAqD;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK,IAAI;AACT;AACO;AACP,iDAAiD,cAAc,eAAe;AAC9E;AACA;AACA,KAAK;AACL;AACO;AACP,iDAAiD,wBAAwB,cAAc,6BAA6B,wEAAwE,oCAAoC,+CAA+C;AAC/Q;AACA;AACA,KAAK;AACL;AACA","sources":["webpack://insights-chrome/./node_modules/@redhat-cloud-services/chrome/esm/ChromeContext/ChromeContext.js","webpack://insights-chrome/./node_modules/@redhat-cloud-services/chrome/esm/ChromeContext/index.js","webpack://insights-chrome/./node_modules/@redhat-cloud-services/chrome/esm/ChromeProvider/ChromeProvider.js","webpack://insights-chrome/./node_modules/@redhat-cloud-services/chrome/esm/ChromeProvider/chromeState.js","webpack://insights-chrome/./node_modules/@redhat-cloud-services/chrome/esm/ChromeProvider/index.js","webpack://insights-chrome/./node_modules/@redhat-cloud-services/chrome/esm/index.js","webpack://insights-chrome/./node_modules/@redhat-cloud-services/chrome/esm/useFavoritePages/index.js","webpack://insights-chrome/./node_modules/@redhat-cloud-services/chrome/esm/useFavoritePages/useFavoritePages.js","webpack://insights-chrome/./node_modules/@redhat-cloud-services/chrome/esm/useLastVisited/index.js","webpack://insights-chrome/./node_modules/@redhat-cloud-services/chrome/esm/useLastVisited/useLastVisited.js","webpack://insights-chrome/./node_modules/@redhat-cloud-services/chrome/esm/useVisitedBundles/index.js","webpack://insights-chrome/./node_modules/@redhat-cloud-services/chrome/esm/useVisitedBundles/useVisitedBundles.js","webpack://insights-chrome/./node_modules/@redhat-cloud-services/chrome/esm/utils/fetch.js"],"sourcesContent":["import { createContext } from 'react';\nvar ChromeContext = createContext({\n    update: function () { return undefined; },\n    setLastVisited: function () { return undefined; },\n    setFavoritePages: function () { return undefined; },\n    subscribe: function () { return Symbol(0); },\n    unsubscribe: function () { return undefined; },\n    setIdentity: function () { return undefined; },\n    setVisitedBundles: function () { return undefined; },\n    getState: function () { return ({\n        lastVisitedPages: [],\n        subscribtions: {},\n        favoritePages: [],\n        visitedBundles: {},\n        initialized: false,\n    }); },\n});\nexport default ChromeContext;\n//# sourceMappingURL=ChromeContext.js.map","export { default } from './ChromeContext';\nexport { default as ChromeContext } from './ChromeContext';\n//# sourceMappingURL=index.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { useEffect, useRef, useState } from 'react';\nimport { useScalprum } from '@scalprum/react-core';\nimport { useLocation } from 'react-router-dom';\nimport { ChromeContext } from '../ChromeContext';\nimport chromeState from './chromeState';\nimport { IDENTITY_URL, LAST_VISITED_URL, get, post } from '../utils/fetch';\nvar getUserIdentity = function () { return get(IDENTITY_URL); };\nvar useLastPageVisitedUploader = function (providerState) {\n    var inactiveDuration = 1000 * 20;\n    var batchUpdateInterval = 1000 * 60 * 3;\n    var inactiveTimeout = useRef(undefined);\n    var postBatchData = function (recentPages) { return __awaiter(void 0, void 0, void 0, function () {\n        var error_1;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    _a.trys.push([0, 2, , 3]);\n                    return [4, post(LAST_VISITED_URL, {\n                            pages: recentPages,\n                        })];\n                case 1:\n                    _a.sent();\n                    return [3, 3];\n                case 2:\n                    error_1 = _a.sent();\n                    console.error('Unable to update last visited pages!', error_1);\n                    return [3, 3];\n                case 3: return [2];\n            }\n        });\n    }); };\n    var sanitizeRecentPages = function (recentPages) {\n        return recentPages.map(function (_a) {\n            var pathname = _a.pathname, title = _a.title, bundle = _a.bundle;\n            return ({ pathname: pathname, title: title, bundle: bundle });\n        });\n    };\n    var clearInactiveTimeout = function () {\n        if (inactiveTimeout.current !== undefined) {\n            clearTimeout(inactiveTimeout.current);\n            inactiveTimeout.current = undefined;\n        }\n    };\n    var updateMostRecentPages = function () { return __awaiter(void 0, void 0, void 0, function () {\n        var recentPages, sanitizedPages;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    recentPages = providerState.getState().lastVisitedPages;\n                    sanitizedPages = sanitizeRecentPages(recentPages);\n                    return [4, postBatchData(sanitizedPages)];\n                case 1:\n                    _a.sent();\n                    return [2];\n            }\n        });\n    }); };\n    useEffect(function () {\n        var updateInterval = setInterval(function () { return __awaiter(void 0, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                updateMostRecentPages();\n                return [2];\n            });\n        }); }, batchUpdateInterval);\n        var handleVisibilityChange = function () {\n            if (document.visibilityState !== 'visible') {\n                if (inactiveTimeout.current) {\n                    return;\n                }\n                inactiveTimeout.current = setTimeout(function () { return __awaiter(void 0, void 0, void 0, function () {\n                    return __generator(this, function (_a) {\n                        updateMostRecentPages();\n                        return [2];\n                    });\n                }); }, inactiveDuration);\n            }\n            else {\n                clearInactiveTimeout();\n            }\n        };\n        document.addEventListener('visibilitychange', handleVisibilityChange);\n        return function () {\n            clearInterval(updateInterval);\n            clearInactiveTimeout();\n            document.removeEventListener('visibilitychange', handleVisibilityChange);\n        };\n    }, []);\n};\nvar LAST_VISITED_FLAG = 'chrome:lastVisited';\nvar useLastVisitedLocalStorage = function (providerState) {\n    var pathname = useLocation().pathname;\n    var scalprum = useScalprum();\n    var titleTarget = document.querySelector('title');\n    var getInitialPages = function () { return __awaiter(void 0, void 0, void 0, function () {\n        var localVisited, firstPages, _a, error_2;\n        var _b, _c;\n        return __generator(this, function (_d) {\n            switch (_d.label) {\n                case 0:\n                    localVisited = [];\n                    try {\n                        localVisited = JSON.parse((_b = localStorage.getItem(LAST_VISITED_FLAG)) !== null && _b !== void 0 ? _b : '[]');\n                        if (!Array.isArray(localVisited)) {\n                            localVisited = [];\n                        }\n                    }\n                    catch (error) {\n                        console.error('Unable to parse last visited pages from localStorage!', error);\n                        localVisited = [];\n                    }\n                    _d.label = 1;\n                case 1:\n                    _d.trys.push([1, 3, , 4]);\n                    _a = [[]];\n                    return [4, get(LAST_VISITED_URL)];\n                case 2:\n                    firstPages = __spreadArray.apply(void 0, [__spreadArray.apply(void 0, _a.concat([((_c = (_d.sent())) !== null && _c !== void 0 ? _c : []), true])), localVisited, true]).slice(0, 10);\n                    providerState.setLastVisited(firstPages);\n                    localStorage.setItem(LAST_VISITED_FLAG, JSON.stringify(firstPages));\n                    return [3, 4];\n                case 3:\n                    error_2 = _d.sent();\n                    console.error('Unable to load initial last visited pages!', error_2);\n                    providerState.setLastVisited(localVisited);\n                    localStorage.setItem(LAST_VISITED_FLAG, JSON.stringify(localVisited));\n                    return [3, 4];\n                case 4: return [2];\n            }\n        });\n    }); };\n    useEffect(function () {\n        getInitialPages();\n    }, []);\n    useEffect(function () {\n        var titleObserver;\n        var prevTitle;\n        if (titleTarget) {\n            titleObserver = new MutationObserver(function (mutations) {\n                var _a, _b;\n                var currentTitle = (_a = mutations[0]) === null || _a === void 0 ? void 0 : _a.target.textContent;\n                if (typeof currentTitle === 'string' && currentTitle !== prevTitle) {\n                    try {\n                        prevTitle = currentTitle;\n                        var newTitles = providerState.getState().lastVisitedPages.filter(function (item) { return item.pathname !== pathname; });\n                        newTitles.unshift({ pathname: pathname, title: currentTitle, bundle: (_b = scalprum.api) === null || _b === void 0 ? void 0 : _b.chrome.getBundleData().bundleTitle });\n                        providerState.setLastVisited(newTitles.slice(0, 10));\n                        localStorage.setItem(LAST_VISITED_FLAG, JSON.stringify(newTitles.slice(0, 10)));\n                    }\n                    catch (error) {\n                        console.error('Unable to update last visited pages!', error);\n                    }\n                }\n            });\n            titleObserver.observe(titleTarget, {\n                childList: true,\n            });\n        }\n        return function () {\n            titleObserver === null || titleObserver === void 0 ? void 0 : titleObserver.disconnect();\n        };\n    }, [pathname]);\n};\nvar ChromeProvider = function (_a) {\n    var children = _a.children;\n    var isMounted = useRef(false);\n    var _b = useState(false), initialRequest = _b[0], setInitialRequest = _b[1];\n    var providerState = useRef();\n    if (!providerState.current) {\n        providerState.current = chromeState();\n    }\n    useLastVisitedLocalStorage(providerState.current);\n    useLastPageVisitedUploader(providerState.current);\n    useEffect(function () {\n        isMounted.current = true;\n        if (!initialRequest) {\n            getUserIdentity()\n                .then(function (identity) {\n                var _a;\n                if (isMounted.current) {\n                    (_a = providerState.current) === null || _a === void 0 ? void 0 : _a.setIdentity(identity);\n                    setInitialRequest(true);\n                }\n            })\n                .catch(function (error) {\n                console.error('Unable to initialize ChromeProvider!', error);\n            });\n        }\n        return function () {\n            isMounted.current = false;\n        };\n    }, []);\n    return _jsx(ChromeContext.Provider, { value: providerState.current, children: children });\n};\nexport default ChromeProvider;\n//# sourceMappingURL=ChromeProvider.js.map","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nexport var UpdateEvents;\n(function (UpdateEvents) {\n    UpdateEvents[\"lastVisited\"] = \"lastVisited\";\n    UpdateEvents[\"favoritePages\"] = \"favoritePages\";\n    UpdateEvents[\"visitedBundles\"] = \"visitedBundles\";\n})(UpdateEvents || (UpdateEvents = {}));\nvar chromeState = function () {\n    var state = {\n        lastVisitedPages: [],\n        favoritePages: [],\n        visitedBundles: {},\n        initialized: false,\n    };\n    var subscriptions = {\n        lastVisited: new Map(),\n        favoritePages: new Map(),\n        visitedBundles: new Map(),\n    };\n    function subscribe(event, onUpdate) {\n        var id = Symbol(event);\n        subscriptions[event].set(id, { onUpdate: onUpdate });\n        onUpdate();\n        return id;\n    }\n    function unsubscribe(id, event) {\n        if (subscriptions[event].has(id)) {\n            subscriptions[event].delete(id);\n        }\n        else {\n            console.error('Trying to unsubscribe non existing client!');\n        }\n    }\n    function update(event, attributes) {\n        state = __assign(__assign({}, state), attributes);\n        var updateSubscriptions = subscriptions[event];\n        if (updateSubscriptions.size === 0) {\n            return;\n        }\n        Array.from(updateSubscriptions.values()).forEach(function (subscriber) {\n            subscriber.onUpdate();\n        });\n    }\n    function setLastVisited(pages) {\n        update(UpdateEvents.lastVisited, { lastVisitedPages: pages });\n    }\n    function setFavoritePages(pages) {\n        update(UpdateEvents.favoritePages, { favoritePages: pages });\n    }\n    function setVisitedBundles(visitedBundles) {\n        update(UpdateEvents.visitedBundles, { visitedBundles: visitedBundles });\n    }\n    function getState() {\n        return state;\n    }\n    function setIdentity(_a) {\n        var lastVisitedPages = _a.lastVisitedPages, userIdentity = __rest(_a, [\"lastVisitedPages\"]);\n        state = __assign(__assign(__assign({}, state), userIdentity), { initialized: true });\n        Object.values(subscriptions)\n            .flat()\n            .forEach(function (event) {\n            Array.from(event.values()).forEach(function (sub) {\n                sub.onUpdate();\n            });\n        });\n    }\n    return {\n        getState: getState,\n        setLastVisited: setLastVisited,\n        setIdentity: setIdentity,\n        setFavoritePages: setFavoritePages,\n        setVisitedBundles: setVisitedBundles,\n        subscribe: subscribe,\n        unsubscribe: unsubscribe,\n        update: update,\n    };\n};\nexport default chromeState;\n//# sourceMappingURL=chromeState.js.map","export { default as ChromeProvider } from './ChromeProvider';\nexport { default } from './ChromeProvider';\nexport { UpdateEvents } from './chromeState';\n//# sourceMappingURL=index.js.map","export * from './ChromeProvider';\nexport * from './ChromeContext';\nexport * from './useLastVisited';\nexport * from './useFavoritePages';\nexport * from './useVisitedBundles';\n//# sourceMappingURL=index.js.map","export { default } from './useFavoritePages';\nexport { default as useFavoritePages } from './useFavoritePages';\n//# sourceMappingURL=index.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nimport { useContext, useEffect, useReducer } from 'react';\nimport { UpdateEvents } from '../ChromeProvider';\nimport { FAVORITE_PAGE_URL, post } from '../utils/fetch';\nimport ChromeContext from '../ChromeContext/ChromeContext';\nfunction handleFavoritePage(pathname, favorite) {\n    return post(FAVORITE_PAGE_URL, {\n        pathname: pathname,\n        favorite: favorite,\n    });\n}\nvar useFavoritePages = function () {\n    var _a = useContext(ChromeContext), subscribe = _a.subscribe, unsubscribe = _a.unsubscribe, getState = _a.getState, setFavoritePages = _a.setFavoritePages;\n    var _b = useReducer(function (count) { return count + 1; }, 0), forceRender = _b[1];\n    function handleFavoriteAPICall(pathname, favorite) {\n        return __awaiter(this, void 0, void 0, function () {\n            var prevPages, newPages, error_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        prevPages = getState().favoritePages;\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        setFavoritePages(__spreadArray(__spreadArray([], prevPages, true), [{ pathname: pathname, favorite: favorite }], false));\n                        return [4, handleFavoritePage(pathname, favorite)];\n                    case 2:\n                        newPages = _a.sent();\n                        setFavoritePages(newPages);\n                        return [2, newPages];\n                    case 3:\n                        error_1 = _a.sent();\n                        console.error(error_1);\n                        setFavoritePages(prevPages);\n                        return [2, prevPages];\n                    case 4: return [2];\n                }\n            });\n        });\n    }\n    function favoritePage(pathname) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2, handleFavoriteAPICall(pathname, true)];\n            });\n        });\n    }\n    function unfavoritePage(pathname) {\n        return handleFavoriteAPICall(pathname, false);\n    }\n    useEffect(function () {\n        var subsId = subscribe(UpdateEvents.favoritePages, forceRender);\n        return function () {\n            unsubscribe(subsId, UpdateEvents.favoritePages);\n        };\n    }, []);\n    return { favoritePages: getState().favoritePages, favoritePage: favoritePage, unfavoritePage: unfavoritePage, initialized: getState().initialized };\n};\nexport default useFavoritePages;\n//# sourceMappingURL=useFavoritePages.js.map","export { default } from './useLastVisited';\nexport { default as useLastVisited } from './useLastVisited';\n//# sourceMappingURL=index.js.map","import { useContext, useEffect, useReducer } from 'react';\nimport { ChromeContext } from '../ChromeContext';\nimport { UpdateEvents } from '../ChromeProvider';\nvar useLastVisited = function () {\n    var _a;\n    var _b = useContext(ChromeContext), subscribe = _b.subscribe, unsubscribe = _b.unsubscribe, getState = _b.getState;\n    var _c = useReducer(function (count) { return count + 1; }, 0), forceRender = _c[1];\n    useEffect(function () {\n        var subsId = subscribe(UpdateEvents.lastVisited, forceRender);\n        return function () {\n            unsubscribe(subsId, UpdateEvents.lastVisited);\n        };\n    }, []);\n    return (_a = getState().lastVisitedPages) !== null && _a !== void 0 ? _a : [];\n};\nexport default useLastVisited;\n//# sourceMappingURL=useLastVisited.js.map","export { default } from './useVisitedBundles';\nexport { default as useVisitedBundles } from './useVisitedBundles';\n//# sourceMappingURL=index.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { useContext, useEffect, useReducer } from 'react';\nimport { UpdateEvents } from '../ChromeProvider';\nimport { VISITED_BUNDLES_URL, post } from '../utils/fetch';\nimport ChromeContext from '../ChromeContext/ChromeContext';\nfunction handleMarkVisited(bundle) {\n    return post(VISITED_BUNDLES_URL, {\n        bundle: bundle,\n    });\n}\nvar useVisitedBundles = function () {\n    var _a = useContext(ChromeContext), subscribe = _a.subscribe, unsubscribe = _a.unsubscribe, getState = _a.getState, setVisitedBundles = _a.setVisitedBundles;\n    var _b = useReducer(function (count) { return count + 1; }, 0), forceRender = _b[1];\n    function markVisited(bundle) {\n        var _a;\n        return __awaiter(this, void 0, void 0, function () {\n            var shouldMarkVisited, updatedUser;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        shouldMarkVisited = !((_a = getState().visitedBundles) === null || _a === void 0 ? void 0 : _a[bundle]);\n                        if (!shouldMarkVisited) return [3, 2];\n                        return [4, handleMarkVisited(bundle)];\n                    case 1:\n                        updatedUser = _b.sent();\n                        setVisitedBundles(updatedUser.visitedBundles);\n                        return [2, updatedUser.visitedBundles];\n                    case 2: return [2, getState().visitedBundles];\n                }\n            });\n        });\n    }\n    useEffect(function () {\n        var subsId = subscribe(UpdateEvents.visitedBundles, forceRender);\n        return function () {\n            unsubscribe(subsId, UpdateEvents.visitedBundles);\n        };\n    }, []);\n    return { visitedBundles: getState().visitedBundles, markVisited: markVisited, initialized: getState().initialized };\n};\nexport default useVisitedBundles;\n//# sourceMappingURL=useVisitedBundles.js.map","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nexport var API_BASE = '/api/chrome-service/v1';\nexport var LAST_VISITED_URL = \"\".concat(API_BASE, \"/last-visited\");\nexport var FAVORITE_PAGE_URL = \"\".concat(API_BASE, \"/favorite-pages\");\nexport var IDENTITY_URL = \"\".concat(API_BASE, \"/user\");\nexport var VISITED_BUNDLES_URL = \"\".concat(API_BASE, \"/user/visited-bundles\");\nfunction fetchWrapper(url, options) {\n    var _this = this;\n    return fetch(url, options).then(function (res) { return __awaiter(_this, void 0, void 0, function () {\n        var clone, isJson, error, _a;\n        var _b;\n        return __generator(this, function (_c) {\n            switch (_c.label) {\n                case 0:\n                    if (!!res.ok) return [3, 5];\n                    clone = res.clone();\n                    isJson = (_b = clone.headers.get('content-type')) === null || _b === void 0 ? void 0 : _b.includes('application/json');\n                    if (!isJson) return [3, 2];\n                    return [4, clone.json()];\n                case 1:\n                    _a = _c.sent();\n                    return [3, 4];\n                case 2: return [4, clone.text()];\n                case 3:\n                    _a = _c.sent();\n                    _c.label = 4;\n                case 4:\n                    error = _a;\n                    throw error;\n                case 5: return [2, res.json()];\n            }\n        });\n    }); });\n}\nexport function get(url, options) {\n    return fetchWrapper(url, __assign(__assign({}, options), { method: 'GET' })).then(function (_a) {\n        var data = _a.data;\n        return data;\n    });\n}\nexport function post(url, data, options) {\n    return fetchWrapper(url, __assign(__assign({ credentials: 'include' }, options), { headers: __assign(__assign({}, options === null || options === void 0 ? void 0 : options.headers), { 'Content-Type': 'application/json' }), method: 'POST', body: JSON.stringify(data) })).then(function (_a) {\n        var data = _a.data;\n        return data;\n    });\n}\n//# sourceMappingURL=fetch.js.map"],"names":[],"sourceRoot":""}